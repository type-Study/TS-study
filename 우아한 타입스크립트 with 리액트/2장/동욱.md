# TS ì»´íŒŒì¼ ë°©ì‹

## **ì†ŒìŠ¤ì½”ë“œì—ì„œ ë°ì´í„°ë¡œ**

### Scanner

Scannerê°€ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¡œ ì…ë ¥ëœ ì½”ë“œë¥¼ í† í°ìœ¼ë¡œ ë³€í™˜í•´ì¤ë‹ˆë‹¤.

```js
const message: string = "Hello, world!"
// Const Keyword
// WhitespaceTrivia
// Identifier
// ColonToken
// WhitespaceTrivia
// StringKeyword
// WhitespaceTrivia
// EqualToken
// WhitespaceTrivia
// StringLiteral
```

ê·¸ë¦¬ê³  ìŠ¤ìºë„ˆëŠ” ì´ ê³¼ì •ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì½”ë“œ ë¬¸ìì—´ì˜ ì •í•©ì„±ë„ ê²€ì‚¬í•©ë‹ˆë‹¤.

```js
let noEnd = " // Unterminated string literal.(1002)
let num = 2__3  // Multiple consecutive numeric separators are not permitted.(6189)
const ğŸ¤” = 'hello' // Invalid character.(1127)
let x1 =  1} // Declaration or statement expected.(1128)
```

### Parser

ê·¸ëŸ° ë‹¤ìŒ Parserê°€ Scannerê°€ ë¶„ë¦¬í•´ì¤€ í† í°ì— ë”°ë¼ ASTë¡œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤. ASTë€ ì†ŒìŠ¤ì½”ë“œë¥¼ ë¬¸ë²•ì— ë§ê²Œ ë…¸ë“œë“¤ë¡œ ìª¼ê°œì„œ ë§Œë“  íŠ¸ë¦¬ì…ë‹ˆë‹¤.

<img src="https://yceffort.kr/_next/image?url=%2F2022%2F05%2Fimages%2Fts-ast.png&w=3840&q=75">

parserì—ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì—ëŸ¬ë¥¼ ì‚´í´ë´…ë‹ˆë‹¤.

```js
#var = 123 // The left-hand side of an assignment expression must be a variable or a property access.(2364)
const decimal = 4.1n // A bigint literal must be an integer.(1353)
var extends = 123 // 'extends' is not allowed as a variable declaration name.(1389)
var x = { class C4 {} } // ':' expected.(1005)
```

## **íƒ€ì… ê²€ì‚¬**

### binder

binderëŠ” AST ì „ì²´ ë…¸ë“œë¥¼ ì½ì–´ì„œ íƒ€ì… ê²€ì‚¬ì— í•„ìš”í•œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤. ê° ì˜ì—­ë³„ë¡œ identifierë¥¼ êµ¬ë¶„í•˜ê³  ì‹ë³„ìê°€ ì–´ëŠ ìœ„ì¹˜ì— ì •ì˜ë˜ì–´ ìˆëŠ” ì§€ ë“± ë©”íƒ€ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ ëƒ…ë‹ˆë‹¤.

```js
const message: string = 'Hello, world!'
welcome(message)

function welcome(str: string) {
  console.log(str)
}
```

ìœ„ ì½”ë“œë¥¼ ë³´ë©´ globe scopeì™€ Function scope ë‘ê°€ì§€ë¡œ ë‚˜ëˆ ì ¸ ìˆìŠµë‹ˆë‹¤.

binerëŠ” ì½”ë“œë¥¼ ìˆœíšŒí•˜ë©´ì„œ ì–´ë–¤ `identifier`ê°€ ìˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

- messageê°€ ì²«ë²ˆì§¸ identifierë¡œ, 0ë²ˆì§¸ ì‹ë³„ìë¡œ ì„¤ì •í•´ë‘ê³ , constì´ê¸° ë•Œë¬¸ì— BlockScopedVariableë¡œ ê¸°ì–µí•´ë‘¡ë‹ˆë‹¤.
- ê·¸ ë‹¤ìŒì—” welcomeì„ ì°¾ì„ ìˆ˜ ìˆëŠ”ë° ì•„ì§ ì´ ì‹ë³„ìëŠ” ì„ ì–¸ë˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì§€ë‚˜ê°‘ë‹ˆë‹¤.
- ì¸ìˆ˜ë¡œ ì„ ì–¸ë˜ì–´ ìˆëŠ” messageë„ í˜„ì¬ëŠ” ê·¸ ì“°ì„ìƒˆë¥¼ ì•Œ ìˆ˜ ì—†ì–´ì„œ ì§€ë‚˜ê°‘ë‹ˆë‹¤..
- welcome í•¨ìˆ˜ê°€ ë³´ì´ê³  welcomeì„ Functionìœ¼ë¡œ ê¸°ì–µí•´ë‘¡ë‹ˆë‹¤.
  - welcomeì€ í•¨ìˆ˜ ìŠ¤ì½”í”„ë¡œ, parentì¸ global scopeë¥¼ ë“±ë¡í•œë‹¤.
  - strì€ í•¨ìˆ˜ì˜ ì¸ìˆ˜ë¡œ, blockvariableë¡œ ë“±ë¡í•œë‹¤.

<img src='https://yceffort.kr/_next/image?url=%2F2022%2F05%2Fimages%2Fsymbol.png&w=1200&q=75'>

</br>

ì´ë ‡ê²Œ ë“±ë¡í•´ë‘” ë°ì´í„°ëŠ” `symbol`ì´ë¼ê³  í•˜ë©° symbolì€ AST ë‚´ì—ì„œ ì„ ì–¸ëœ ì—¬ëŸ¬ nodeë“¤ì´ ë™ì¼í•œ ê°œì²´ì¸ê±¸ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ ì¦‰ ë‚˜ì¤‘ì— identiferë¥¼ ë§Œë‚ ë•Œ ë¬´ì—‡ì¸ì§€ íŒë‹¨í•˜ê¸° ìœ„í•´ nodeì™€ ì—°ê²°í•˜ê³  symbol tableì— í•´ì‰¬ë§µìœ¼ë¡œ ì •ì˜ë©ë‹ˆë‹¤.

</br>
<img src='https://raw.githubusercontent.com/huytd/everyday/master/_meta/tsc-binder-symbols.png'>

ë˜ í•œê°€ì§€ binderëŠ” Flow nodesë¡œ ë³€ìˆ˜ë¥¼ ì¶”ì í•©ë‹ˆë‹¤.
ì½”ë“œì— ì¡°ê±´ë¶€ê°€ ìˆì„ ê²½ìš° Flow Conditionalì„ ê¸°ì¤€ìœ¼ë¡œ ì˜ì—­ì„ ì •í•´ì„œ Flow Containerë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

<img src='https://user-images.githubusercontent.com/69669694/211247877-e461e6d5-2a2b-4472-947c-bf81ea136fca.jpg'>

íƒ€ì… ìŠ¤í¬ë¦½íŠ¸ëŠ” ê²€ì‚¬í•  ë…¸ë“œë¡œë¶€í„° ë¶€ëª¨ ë…¸ë“œë¥¼ ì°¾ì•„ê°€ë©° ì—­ ë°©í–¥ìœ¼ë¡œ ë³€ìˆ˜ì™€ íƒ€ì…ì„ ì¶”ì í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
// string, number
function log(x: string | number) {
  // string number
  if (typeof x === "string") {
    // string
    // (1)
    return x;
  } else {
    // number
    return x + 1;
  }
}
```

1ë²ˆì—ì„œ ì‹œì‘í•œë‹¤ê³  ê°€ì •í•˜ë©´ flow nodeë¥¼ í†µí•´ xì˜ íƒ€ì…ì´ ë¬´ì—‡ì¸ì§€ ë¬¼ì–´ë³´ê³  ê°€ì¥ ë¨¼ì € ë§Œë‚˜ëŠ” flow conditionalì„ í†µí•´ í†µí•´ xì˜ íƒ€ì…ì´ stringì„ì„ ì•Œê²Œë©ë‹ˆë‹¤. ì¦‰ bottom-to-top ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

binderë„ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ê²€ì‚¬í•˜ëŠ” ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.

```js
const a = 123
delete a // 'delete' cannot be called on an identifier in strict mode.(1102)

const abc = 123
const abc = 123 // Cannot redeclare block-scoped variable 'abc'.(2451)

yield // Identifier expected. 'yield' is a reserved word in strict mode.

class A {} // duplicate identifier 'A;
type A {}
```

### checker

TypeCheckerëŠ” ASTì™€ Symbols tableì„ ê¸°ì¤€ìœ¼ë¡œ íƒ€ì… ê²€ì‚¬ë¥¼ ì‹œí–‰í•©ë‹ˆë‹¤. ê²€ì‚¬ëŠ” êµ¬ì¡°ì ìœ¼ë¡œ ì´ë£¨ì–´ ì§€ë©° ì™¸ë¶€ì—ì„œ ë‚´ë¶€ë¡œ ì§„í–‰ë©ë‹ˆë‹¤. ì´ ê°’ì´ object í˜•íƒœì¸ì§€, ê·¸ë¦¬ê³  í•„ë“œ, ë§ˆì§€ë§‰ìœ¼ë¡œ ê°’ì˜ íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ”ì§€ ë¹„êµí•©ë‹ˆë‹¤. ì´ëŸ¬í•œ ê²€ì‚¬ ë°©ì‹ì€ `êµ¬ì¡°ì  íƒ€ì´í•‘`ì´ë¼ê³  í•©ë‹ˆë‹¤.

```ts
{age: number} = {age: '123'}
```

ìœ„ì™€ ê°™ì€ ê²½ìš°ì—ëŠ” TypeFlags.NumberLikeì™€ '123'ì€ TypeFlags.StringLiteralì´ë¯€ë¡œ falseë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

ì´ ë¹„êµëŠ” TypeFlagsë¥¼ ì‚¬ìš©í•˜ê³  ìˆê³  ì´ Enumì€ TypescriptíŒŒì¼ì˜ /src/compiler/types.tsì— ì •ì˜ ë˜ì–´ìˆìŠµë‹ˆë‹¤.

ì•„ë˜ì™€ ê°™ì´ íƒ€ì…ì„ ì§€ì •í•˜ì§€ ì•Šì„ ê²½ìš° ASTì˜ initializerì˜ ê²°ê³¼ê°’('Hello world')ì˜ íƒ€ì…ì„ messageì˜ type ì‹ í…ìŠ¤ë¡œ ëŒ€ì…í•©ë‹ˆë‹¤.

```js
const message = "Hello world";
```

ì´ë ‡ë“¯ TSì˜ íƒ€ì… ì¶”ë¡ ì€ ê°’ì˜ í˜•íƒœì— ê¸°ë°˜í•˜ì—¬ ì´ë¤„ì§‘ë‹ˆë‹¤.

### transform

TSë¥¼ JSë¡œ ë°”ê¾¸ë ¤ë©´ compile Optionì´ í•„ìš”í•œë° tsConfig.json íŒŒì¼ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.

```
{
  "compilerOptions": {
    "module": "system",		// TSCê°€ ì»´íŒŒì¼í•  ëŒ€ìƒ ëª¨ë“ˆ ì‹œìŠ¤í…œ
    "outDir": "dist",		// ìƒì„±ëœ ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ë””ë ‰í„°ë¦¬
    "target": "es2015",		// ì»´íŒŒì¼ í•  ìë°”ìŠ¤í¬ë¦½íŠ¸ ë²„ì „
  },
  "include": ["src/**/*"],  // typescript ê°€ ì°¾ì„ ë””ë ‰í„°ë¦¬
}
```

íƒ€ì… ìŠ¤í¬ë¦½íŠ¸ì—ì„œëŠ” ASTë¥¼ íŒŒì¼ë¡œ ë³€í™”í•´ì£¼ëŠ” emmiterê°€ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ì™€ ê°™ì´ ë‘ê°€ì§€ ì—­í• ì´ ìˆìŠµë‹ˆë‹¤.

</br>
<img src='https://user-images.githubusercontent.com/69669694/211272007-8b053cef-8292-4801-a582-3d8574d21c53.png'>

</br>
emitterëŠ” ASTì™€ Checkerë¥¼ í†µí•´ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì½”ë“œë¥¼ ë§Œë“­ë‹ˆë‹¤. ë¨¼ì € TS ASTë¥¼ JS ASTë¡œ ë³€í™˜í•©ë‹ˆë‹¤.

TSì˜ ASTì—ì„œ íƒ€ì…ì„ ë‚˜íƒ€ë‚´ëŠ” Keyword ì‹ í…ìŠ¤ë¥¼ ì œê±°í•˜ëŠ” ê³¼ì •ì…ë‹ˆë‹¤.

- VariableStatement
  - VariableDeclarationList
    - VariableDeclaration
      - identifier (name)
      - StringKeyword (type)
      - StringLiteral (initializer)

ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ ì‹ íƒìŠ¤ íŠ¸ë¦¬

- VariableStatement
  - VariableDeclarationList
    - VariableDeclaration
      - identifier (name)
      -
      - StringLiteral (initializer)

ê·¸ í›„ ê° ë¬¸ë²• ë²„ì „ì— ë”°ë¼ Asset flagë¥¼ ì§€ì •í•©ë‹ˆë‹¤. ì´ë ‡ê²Œ Asset, JS, TS ì½”ë“œë¡œ êµ¬ë¶„í•˜ì—¬ ì²˜ë¦¬í•œ í›„ JS ì½”ë“œ(.js)ë¥¼ ë§Œë“¤ì–´ ëƒ…ë‹ˆë‹¤. ë˜í•œ íƒ€ì„ë§Œ ì •ì˜í•´ ë†“ì€ typeDefinition (.d.ts)íŒŒì¼ë„ í•¨ê»˜ ìƒì„±í•©ë‹ˆë‹¤. ì´ .d.tsíŒŒì¼ì€ ì»´íŒŒì¼ëŸ¬ê°€ ë§Œë“¤ì–´ ë‚´ê¸°ë„ í•˜ì§€ë§Œ ì‚¬ìš©ìê°€ ì •ì˜í•  ìˆ˜ ìˆëŠ” íŒŒì¼ì´ì—¬ì„œ ì´ íŒŒì¼ë¡œ ë³€ìˆ˜ ìœ í˜•ì„ ì§€ì •í•´ ë†“ìœ¼ë©´ ì»´íŒŒì¼ëŸ¬ëŠ” .d.tsë¥¼ ì´ìš©í•´ íƒ€ì… ì¶”ë¡ ì— ì°¸ê³ í•©ë‹ˆë‹¤.
